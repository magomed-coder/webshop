# –°–∏—Å—Ç–µ–º–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –∏ –∑–∞–∫–∞–∑–æ–≤

–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, API, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —É—á—ë—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –∑–∞–∫–∞–∑–æ–≤ –∏ –≤—ã–ø–ª–∞—Ç.

---

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã. –ö–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ –∂–∏–≤—ë—Ç **24 —á–∞—Å–∞**, –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É.

–ß–µ—Ä–µ–∑ —ç—Ç–∏ —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

- –¥–µ–ª—è—Ç—Å—è —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö;
- –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ;
- –ø–æ–ª—É—á–∞—é—Ç –±–æ–Ω—É—Å—ã –∑–∞ —É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏;
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –∫–ª–∏–∫–∏, –∑–∞–∫–∞–∑—ã –∏ –≤—ã–ø–ª–∞—Ç—ã.

–ü–µ—Ä–µ—Ö–æ–¥—ã –ø–æ —Å—Å—ã–ª–∫–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≥–¥–µ –∫–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É. –ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è **Order**, –∫–æ—Ç–æ—Ä—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç.

–ö–æ–≥–¥–∞ –∑–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è **Payment**. –ü–æ—Å–ª–µ –≤—ã–ø–ª–∞—Ç—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –∑–∞–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É.

---

# üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

## 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏

**–ü—Ä–æ—Ü–µ—Å—Å:** –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí API ‚Üí –ë–î

```text
User (mobile)
    |
    v
[POST /share-links]
    |
    v
Back-end:
  - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç referralCode
  - –¥–æ–±–∞–≤–ª—è–µ—Ç userId –∏ productId
  - expiryDate = now + 24h
  - clickCount = 0
  - payoutAmountLeft = referralBonus + extraBonus
  - status = "active"
    |
    v
  DB: ShareLinks
```

---

## 2. –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ (–≤–µ–±)

```text
Client Browser ‚Üí /r/:referralCode
    |
    v
[GET /share-links/:referralCode]
    |
    v
Back-end:
  - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
  - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
  - –µ—Å–ª–∏ –∏—Å—Ç–µ–∫–ª–∞ ‚Üí { status: "expired" }
  - –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞:
      clickCount++
      –≤–µ—Ä–Ω—É—Ç—å productId, categoryName, shareLinkId
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
/products/:category/:productId
```

---

## 3. –ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è Order

```text
Client ‚Üí [POST /orders]
```

Body –ø—Ä–∏–º–µ—Ä–∞:

```json
{
  "name": "–ï–ª–µ–Ω–∞",
  "phone": "+79998887766",
  "productId": 120,
  "referralCode": "ABC123"
}
```

**Back-end:**

- –Ω–∞—Ö–æ–¥–∏—Ç ShareLink
- —Å–æ–∑–¥–∞—ë—Ç Order:

  - status = "pending"
  - shareLinkId
  - referralReward = referralBonus + extraBonus

- —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç ShareLink.totalOrders

---

## 4. –†–∞–±–æ—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

–ú–µ–Ω–µ–¥–∂–µ—Ä –≤ –∞–¥–º–∏–Ω–∫–µ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:

```
pending ‚Üí in_progress ‚Üí success / failed
```

---

## 5. –°–æ–∑–¥–∞–Ω–∏–µ Payment –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫–∞–∑–µ

–ï—Å–ª–∏ `Order.status = success`:

```
—Å–æ–∑–¥–∞—ë—Ç—Å—è Payment:
  - orderId
  - shareLinkId
  - amount = referralReward
  - status = "created"
```

---

## 6. –í—ã–ø–ª–∞—Ç–∞ (Payment ‚Üí paid)

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–µ–π:

```text
[Payment paid]
    |
    v
Order.payoutPaid = true
    |
    v
sumPayments = SUM(Payments where shareLinkId)
    |
    v
ShareLink.payoutAmountLeft = totalBonus - sumPayments
    |
    v
–£—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è ShareLink:
  - payoutAmountLeft == 0
  - –Ω–µ—Ç Orders –≤ pending –∏–ª–∏ in_progress
  - (expiryDate < now) –ò–õ–ò (–≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã)
    |
    v
–ï—Å–ª–∏ –≤—Å–µ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí ShareLink.status = "closed"
```

---

# üß± –°—Ö–µ–º–∞ —Å–≤—è–∑–µ–π –º–æ–¥–µ–ª–µ–π

```text
User 1 ‚îÄ‚îÄ‚îÄ‚îÄ M ShareLinks
ShareLinks 1 ‚îÄ‚îÄ‚îÄ‚îÄ M Orders
Orders 1 ‚îÄ‚îÄ‚îÄ‚îÄ 1 Payments
```

---

# üîÑ –°—Ç–∞—Ç—É—Å—ã

## Order.status

- `pending` ‚Äî –∫–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–∏–ª –∑–∞—è–≤–∫—É
- `in_progress` ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- `success` ‚Äî —Å–¥–µ–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- `failed` ‚Äî —Å–¥–µ–ª–∫–∞ –Ω–µ —Å–æ—Å—Ç–æ—è–ª–∞—Å—å

## Payment.status

- `created` ‚Äî –Ω–∞—á–∏—Å–ª–µ–Ω–æ
- `paid` ‚Äî –≤—ã–ø–ª–∞—á–µ–Ω–æ

## ShareLink.status

- `active` ‚Äî —Ä–∞–±–æ—á–∞—è —Å—Å—ã–ª–∫–∞
- `expired` ‚Äî —Å—Ä–æ–∫ –≤—ã—à–µ–ª, –Ω–æ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã
- `closed` ‚Äî –≤—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞–∫—Ä—ã—Ç—ã, –≤—ã–ø–ª–∞—Ç—ã —Å–¥–µ–ª–∞–Ω—ã

---

# üåê API Endpoints

–ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ API-–º–µ—Ç–æ–¥—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º–æ–π.

## üîó ShareLinks

### **POST /share-links** ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É

```json
{
  "productId": 105
}
```

### **GET /share-links/:referralCode** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫—É

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç productId –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

### **GET /users/:id/share-links** ‚Äî —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìù Orders

### **POST /orders** ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑

```json
{
  "name": "–ò–≤–∞–Ω",
  "phone": "+79998887766",
  "productId": 105,
  "referralCode": "ABC123"
}
```

### **PATCH /orders/:id/status** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```json
{
  "status": "in_progress"
}
```

---

## üí∏ Payments

### **POST /payments** ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂

```json
{
  "orderId": 530,
  "amount": 1500
}
```

### **PATCH /payments/:id/pay** ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É

---

# ‚úîÔ∏è –ò—Ç–æ–≥–∏

README —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É;
- –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ –¥–æ –≤—ã–ø–ª–∞—Ç;
- —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤, —Å—Å—ã–ª–æ–∫ –∏ –≤—ã–ø–ª–∞—Ç;
- —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Å–Ω–æ–≤–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤;
- —Å—Ö–µ–º—ã –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –º–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å:

- ER-–¥–∏–∞–≥—Ä–∞–º–º—É (mermaid)
- –ø—Ä–∏–º–µ—Ä—ã SQL/Prisma —Å—Ö–µ–º
- –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger/OpenAPI
- —Å—Ö–µ–º—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ª–æ–≥–∏–∫–∏ (React Native + React)
