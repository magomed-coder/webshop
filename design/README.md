# –°–∏—Å—Ç–µ–º–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –∏ —Å–¥–µ–ª–æ–∫

## –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, API –∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ —É—á—ë—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –∑–∞–∫–∞–∑–æ–≤ –∏ –≤—ã–ø–ª–∞—Ç.

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è Í≥µÏú† —Ç–æ–≤–∞—Ä–∞.
–ö–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ –∂–∏–≤—ë—Ç 24 —á–∞—Å–∞ –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –ø—Ä–æ–¥—É–∫—Ç—É.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:

- –¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–∞–º–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö;
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–π —Å—Å—ã–ª–∫–µ;
- –≤–∏–¥–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ —É—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫;
- –ø–æ–ª—É—á–∞—Ç—å –≤—ã–ø–ª–∞—Ç—ã –∑–∞ —É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –ø–æ —Å–≤–æ–∏–º —Å—Å—ã–ª–∫–∞–º.
  –ü–µ—Ä–µ—Ö–æ–¥—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É ‚Äî –∏–∑ –Ω–µ—ë —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–∫–∞–∑.
  –ê–¥–º–∏–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Å–¥–µ–ª–æ–∫ –∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –≤—ã–ø–ª–∞—Ç—ã.

---

![–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–∏—Å—Ç–µ–º—ã](./Followthelinkandcreateanorder.png){width=1200px}
![–î–∏–∞–≥—Ä–∞–º–º–∞ –≤—ã–ø–ª–∞—Ç](Paymentprocess.png){width=1200px}
![–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞](Full_cycle_of_system_data.png)

# üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

## 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí API ‚Üí –ë–î)

User (mobile)
|
v
[POST /share-links]
|
v
Back-end:

- –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç referralCode
- status = "active"
- expiryDate = now + 24h
- clickCount = 0
- payoutAmountLeft = referralBonus + extraBonus
  |
  v
  DB: ShareLinks
  |
  v
  JSON Response:
  {
  "referralCode": "ABC123",
  "productId": 105,
  "expiryDate": "2025-11-16T12:34:56Z",
  "status": "active",
  "clickCount": 0,
  "payoutAmountLeft": 500
  }

## 2. –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ (–≤–µ–± ‚Üí API ‚Üí React App)

Client Browser ‚Üí /r/:referralCode
|
v
[GET /share-links/:referralCode]
|
v
Back-end:

- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç exists?
- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç expiryDate?
- –µ—Å–ª–∏ –∏—Å—Ç–µ–∫–ª–æ ‚Üí { status: "expired" }
- –µ—Å–ª–∏ –æ–∫:
  clickCount++
  –≤–µ—Ä–Ω—É—Ç—å:
  - productId
  - categoryName
  - referralCode
    ProductRedirect ‚Üí navigate('/products/:category/:id', state: { referralCode })

## 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è Order

Client ‚Üí [POST /orders]
body: { name, phone, productId, referralCode }
|
v
Back-end:

- –∏—â–µ—Ç ShareLink
- —Å–æ–∑–¥–∞—ë—Ç Order:
  status = "pending"
  shareLinkId
  amount = product.price
  referralReward = product.referralBonus + product.extraBonus - –æ–±–Ω–æ–≤–ª—è–µ—Ç ShareLink.totalOrders++

## 4. –†–∞–±–æ—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ / —Ä–∏–µ–ª—Ç–æ—Ä–∞

–ú–µ–Ω–µ–¥–∂–µ—Ä ‚Üí AdminPanel ‚Üí –º–µ–Ω—è–µ—Ç Order.status:
pending ‚Üí in_progress
in_progress ‚Üí success / failed

## 5. –°–æ–∑–¥–∞–Ω–∏–µ Payment –ø–æ —É—Å–ø–µ—à–Ω–æ–º—É –∑–∞–∫–∞–∑—É

–µ—Å–ª–∏ Order.status = success:
|
v
—Å–æ–∑–¥–∞—ë–º Payment: - orderId - shareLinkId - amount = order.referralReward - status = "created"
|
v
Order.status = pending_payment

## 6. –í—ã–ø–ª–∞—Ç–∞ (Payment.paid). –ü–æ—Å–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è:

[Payment paid]
|
v
Back-end:

- Payment.status = "paid"
- Order.payoutPaid = true
- Order.status = "paid_out"
- sumPayments = SUM(Payments where shareLinkId)
- ShareLink.payoutAmountLeft = shareLink.totalPayout - sumPayments
  |
  v

—É—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Å—ã–ª–∫–∏:

- payoutAmountLeft == 0
- Orders —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ failed –∏–ª–∏ paid_out
- (expiryDate < now) –ò–õ–ò (–≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω—ã)
  |
  v
  –µ—Å–ª–∏ –î–∞ ‚Üí ShareLink.status = "closed"

# ‚úîÔ∏è –°–•–ï–ú–ê –°–í–Ø–ó–ï–ô –ú–ï–ñ–î–£ –ú–û–î–ï–õ–Ø–ú–ò

User
|
| 1 - M
v
ShareLink
|
| 1 - M
v
Orders
|
| 1 - 1 (–∏–ª–∏ 1 - M, –µ—Å–ª–∏ split payments)
v
Payments

# ‚úîÔ∏è –°–•–ï–ú–ê –î–í–ò–ñ–ï–ù–ò–Ø –î–ï–ù–ï–ì –ò –°–¢–ê–¢–£–°–û–í

## Order.status

pending ‚Üí –∫–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–∏–ª –∑–∞—è–≤–∫—É
in_progress ‚Üí –ø–µ—Ä–µ–¥–∞–Ω–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É
failed ‚Üí —Å–¥–µ–ª–∫–∞ –Ω–µ —Å–æ—Å—Ç–æ—è–ª–∞—Å—å
`success` ‚Üí –°–¥–µ–ª–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
`pending_payment` ‚Üí –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç –∏ –ø–µ—Ä–µ–¥–∞–Ω –Ω–∞ –≤—ã–ø–ª–∞—Ç—É
`paid_out` ‚Üí –í—ã–ø–ª–∞—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é

![–î–∏–∞–≥—Ä–∞–º–º–∞ Order](Order_statuses.png)

## Payment.status

created ‚Üí –Ω–∞—á–∏—Å–ª–µ–Ω–æ/ –∫ –≤—ã–ø–ª–∞—Ç–µ
paid ‚Üí –≤—ã–ø–ª–∞—á–µ–Ω–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é

![–î–∏–∞–≥—Ä–∞–º–º–∞ Payment](Payment_statuses.png)

## ShareLink.status

active ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å
expired ‚Üí –≤—Ä–µ–º—è —Å—Å—ã–ª–∫–∏ –ø—Ä–æ—à–ª–æ, –Ω–æ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã
closed ‚Üí –≤—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞–∫—Ä—ã—Ç—ã, –≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã —Å–¥–µ–ª–∞–Ω—ã

![–î–∏–∞–≥—Ä–∞–º–º–∞ ShareLink](Link_statuses.png)

# ‚úîÔ∏è –ó–ê–ü–†–û–°–´ API (–µ–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

# ShareLinks

## –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É

POST /share-links
{
"productId": 105
}

## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä

GET /share-links/:referralCode

## –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

GET /users/:id/share-links

# Orders

## –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑

POST /orders
{
"name": "–ò–≤–∞–Ω",
"phone": "+79998887766",
"productId": 105,
"referralCode": "ABC123"
}

## –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å

PATCH /orders/:id/status
{
"status": "in_progress"
}

# Payments

## –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂

POST /payments
{
"orderId": 530,
"amount": 1500
}

## –í—ã–ø–ª–∞—Ç–∏—Ç—å

PATCH /payments/:id/pay
–¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–¥–µ–ª–∞—Ç—å —á–∏—Å—Ç–æ –Ω–∞ readme.md

Diagram

USERS {
int id PK
string name
string email
string phone
string role // user | partner | manager | admin
datetime createdAt
datetime updatedAt
}

SHARELINKS {
int id PK
int userId FK
int productId
string referralCode
string status
datetime expiryDate
int clickCount
float payoutAmountLeft
int totalOrders
}

ORDERS {
int id PK
int shareLinkId FK
string name
string phone
int productId
float amount
float referralReward
string status
bool payoutPaid
datetime createdAt
}

PAYMENTS {
int id PK
int orderId FK
int shareLinkId FK
float amount
string status
datetime createdAt
}

USERS ||--o{ SHARELINKS : "1 - M"
SHARELINKS ||--o{ ORDERS : "1 - M"
ORDERS ||--|| PAYMENTS : "1 - 1"

```

```
